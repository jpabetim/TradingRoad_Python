{% extends "dashboard/base.html" %}

{% block title %}TradingRoad - Dashboard{% endblock %}

{% block page_title %}Panel Principal{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Bienvenido a TradingRoad</h5>
            </div>
            <div class="card-body">
                <p>Esta es tu plataforma avanzada de trading con análisis en tiempo real, conexión a múltiples exchanges y análisis con inteligencia artificial.</p>
                <p>Utiliza el menú lateral para navegar entre las diferentes secciones:</p>
                <div class="row mt-4">
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 bg-dark">
                            <div class="card-body text-center">
                                <i class="bi bi-graph-up text-primary" style="font-size: 2.5rem;"></i>
                                <h5 class="mt-3">Trading</h5>
                                <p>Gráficos interactivos y operaciones en tiempo real</p>
                                <a href="/dashboard/trading" class="btn btn-outline-primary">Acceder</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 bg-dark">
                            <div class="card-body text-center">
                                <i class="bi bi-bar-chart text-success" style="font-size: 2.5rem;"></i>
                                <h5 class="mt-3">Análisis</h5>
                                <p>Análisis técnico avanzado con indicadores personalizables</p>
                                <a href="/dashboard/analysis" class="btn btn-outline-success">Acceder</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 bg-dark">
                            <div class="card-body text-center">
                                <i class="bi bi-activity text-warning" style="font-size: 2.5rem;"></i>
                                <h5 class="mt-3">Volatilidad</h5>
                                <p>Análisis de volatilidad y correlación de activos</p>
                                <a href="/dashboard/volatility" class="btn btn-outline-warning">Acceder</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 bg-dark">
                            <div class="card-body text-center">
                                <i class="bi bi-newspaper text-info" style="font-size: 2.5rem;"></i>
                                <h5 class="mt-3">Noticias</h5>
                                <p>Noticias del mercado y calendario económico actualizado</p>
                                <a href="/dashboard/news" class="btn btn-outline-info">Acceder</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Mercados principales</h5>
            </div>
            <div class="card-body">
                <div id="market-summary-loading">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
                <div id="market-summary" class="table-responsive" style="display: none;">
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                                <th>Símbolo</th>
                                <th>Precio</th>
                                <th>Cambio 24h</th>
                                <th>Volumen 24h</th>
                            </tr>
                        </thead>
                        <tbody id="market-data">
                            <!-- Los datos se cargarán mediante JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Noticias recientes</h5>
            </div>
            <div class="card-body">
                <div id="news-loading">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-info" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
                <div id="news-summary" style="display: none;">
                    <ul class="list-group list-group-flush" id="news-list">
                        <!-- Las noticias se cargarán mediante JavaScript -->
                    </ul>
                    <div class="text-center mt-3">
                        <a href="/dashboard/news" class="btn btn-sm btn-outline-info">Ver todas las noticias</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Cargamos los datos del mercado
        fetch('/api/v1/exchanges/markets?limit=10')
            .then(response => response.json())
            .then(data => {
                document.getElementById('market-summary-loading').style.display = 'none';
                document.getElementById('market-summary').style.display = 'block';
                
                const marketDataElement = document.getElementById('market-data');
                
                if (data && data.length > 0) {
                    data.forEach(market => {
                        const row = document.createElement('tr');
                        
                        // Clase para color según cambio positivo/negativo
                        const changeClass = market.change_24h >= 0 ? 'text-success' : 'text-danger';
                        const changeIcon = market.change_24h >= 0 ? '↑' : '↓';
                        
                        row.innerHTML = `
                            <td>${market.symbol}</td>
                            <td>${parseFloat(market.last_price).toLocaleString('es-ES')}</td>
                            <td class="${changeClass}">${changeIcon} ${Math.abs(market.change_24h).toFixed(2)}%</td>
                            <td>${parseFloat(market.volume_24h).toLocaleString('es-ES')}</td>
                        `;
                        
                        marketDataElement.appendChild(row);
                    });
                } else {
                    marketDataElement.innerHTML = '<tr><td colspan="4" class="text-center">No hay datos disponibles</td></tr>';
                }
            })
            .catch(error => {
                document.getElementById('market-summary-loading').style.display = 'none';
                document.getElementById('market-summary').style.display = 'block';
                document.getElementById('market-data').innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error al cargar datos</td></tr>';
                console.error('Error al obtener datos del mercado:', error);
            });
            
        // Cargamos las noticias recientes
        fetch('/api/v1/news?limit=5')
            .then(response => response.json())
            .then(data => {
                document.getElementById('news-loading').style.display = 'none';
                document.getElementById('news-summary').style.display = 'block';
                
                const newsListElement = document.getElementById('news-list');
                
                if (data && data.length > 0) {
                    data.forEach(news => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item bg-transparent border-bottom border-secondary';
                        
                        // Formateamos la fecha
                        const date = new Date(news.time_published);
                        const formattedDate = date.toLocaleDateString('es-ES', { 
                            day: '2-digit', 
                            month: 'short', 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });
                        
                        li.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${news.title}</h6>
                                <small class="text-muted">${formattedDate}</small>
                            </div>
                            <small>${news.summary.substring(0, 100)}...</small>
                        `;
                        
                        newsListElement.appendChild(li);
                    });
                } else {
                    newsListElement.innerHTML = '<li class="list-group-item bg-transparent">No hay noticias disponibles</li>';
                }
            })
            .catch(error => {
                document.getElementById('news-loading').style.display = 'none';
                document.getElementById('news-summary').style.display = 'block';
                document.getElementById('news-list').innerHTML = '<li class="list-group-item bg-transparent text-danger">Error al cargar noticias</li>';
                console.error('Error al obtener noticias:', error);
            });
    });
</script>
{% endblock %}
