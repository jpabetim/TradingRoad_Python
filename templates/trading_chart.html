<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingRoad - Análisis Avanzado</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    
    <!-- Estilos personalizados -->
    <link href="{{ url_for('static', path='/css/style.css') }}" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', path='/img/favicon.ico') }}">
    
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background-color: #1e1e1e !important;
            border-bottom: 1px solid #333;
        }
        .chart-container {
            height: 600px;
            position: relative;
            width: 100%;
            background-color: #131722;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .chart-header {
            padding: 10px 15px;
            background-color: #1e1e2d;
            border-bottom: 1px solid #2a2a3c;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chart-title {
            color: #e0e0e0;
            margin: 0;
            font-size: 18px;
            font-weight: 500;
        }
        #chart {
            width: 100%;
            height: 500px;
        }
        .controls {
            background-color: #1e1e2d;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .control-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-label {
            color: #7d8fb3;
            font-size: 14px;
            font-weight: 500;
            margin: 0;
        }
        select.form-select, input.form-control {
            background-color: #131722;
            color: #e0e0e0;
            border: 1px solid #2a2a3c;
        }
        select.form-select:focus, input.form-control:focus {
            background-color: #131722;
            color: #e0e0e0;
            border-color: #3f6ad8;
            box-shadow: none;
        }
        .form-switch .form-check-input {
            background-color: #131722;
            border-color: #2a2a3c;
        }
        .form-switch .form-check-input:checked {
            background-color: #26a69a;
            border-color: #26a69a;
        }
        .btn-primary {
            background-color: #2962ff;
            border-color: #2962ff;
        }
        .btn-primary:hover {
            background-color: #0d47a1;
            border-color: #0d47a1;
        }
        .btn-danger {
            background-color: #ef5350;
            border-color: #ef5350;
        }
        .btn-success {
            background-color: #26a69a;
            border-color: #26a69a;
        }
        .analysis-container {
            background-color: #1e1e2d;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .analysis-title {
            color: #e0e0e0;
            margin-bottom: 15px;
            font-weight: 500;
            font-size: 18px;
            border-bottom: 1px solid #2a2a3c;
            padding-bottom: 10px;
        }
        .analysis-item {
            margin-bottom: 20px;
        }
        .analysis-label {
            color: #7d8fb3;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        .analysis-value {
            color: #e0e0e0;
            font-size: 16px;
            font-weight: 400;
        }
        .bullish {
            color: #26a69a;
        }
        .bearish {
            color: #ef5350;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-graph-up-arrow"></i> TradingRoad
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard/">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard/trading">Trading</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/analysis/tradingview">Análisis</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/api/docs">API Docs</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <button class="btn btn-outline-light me-2" id="lightModeBtn">
                        <i class="bi bi-sun"></i> Light Mode
                    </button>
                    <button class="btn btn-outline-light" id="hideShowPanelBtn">
                        <i class="bi bi-layout-sidebar"></i> Hide Panel
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4 px-4">
        <div class="row">
            <div class="col-12" id="controlsContainer">
                <div class="controls">
                    <div class="control-item">
                        <span class="control-label">Data Source:</span>
                        <select class="form-select form-select-sm" id="dataSource">
                            <option value="binance_futures">Binance Futures</option>
                            <option value="binance_spot">Binance Spot</option>
                            <option value="bybit">Bybit</option>
                            <option value="kucoin">KuCoin</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <span class="control-label">Trading Pair:</span>
                        <input type="text" class="form-control form-control-sm" id="tradingPair" value="ETHUSDT" placeholder="Enter symbol...">
                    </div>
                    <div class="control-item">
                        <span class="control-label">Timeframe:</span>
                        <div class="btn-group btn-group-sm" role="group" id="timeframeGroup">
                            <button type="button" class="btn btn-outline-secondary" data-timeframe="1m">1M</button>
                            <button type="button" class="btn btn-outline-secondary active" data-timeframe="5m">5M</button>
                            <button type="button" class="btn btn-outline-secondary" data-timeframe="15m">15M</button>
                            <button type="button" class="btn btn-outline-secondary" data-timeframe="1h">1H</button>
                            <button type="button" class="btn btn-outline-secondary" data-timeframe="4h">4H</button>
                            <button type="button" class="btn btn-outline-secondary" data-timeframe="1d">1D</button>
                            <button type="button" class="btn btn-outline-secondary" data-timeframe="1w">1W</button>
                        </div>
                    </div>
                    <div class="control-item">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="autoUpdateSwitch" checked>
                            <label class="form-check-label" for="autoUpdateSwitch">Auto-update</label>
                        </div>
                    </div>
                    <div class="control-item ms-auto">
                        <button class="btn btn-sm btn-outline-secondary" id="hideAllDrawings">
                            <i class="bi bi-eye-slash"></i> Hide Drawings
                        </button>
                        <button class="btn btn-sm btn-primary ms-2" id="analyzeBtn">
                            <i class="bi bi-magic"></i> Analyze (AI)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-9">
                <div class="chart-container">
                    <div class="chart-header">
                        <h5 class="chart-title" id="chartTitle">ETHUSDT - 5M</h5>
                        <div>
                            <span class="me-2" id="currentPrice">$2,568.75</span>
                            <span class="bullish" id="priceChange">+1.2%</span>
                        </div>
                    </div>
                    <div id="chart"></div>
                </div>
            </div>
            <div class="col-md-3" id="analysisPanel">
                <div class="analysis-container">
                    <h6 class="analysis-title">AI Analysis Results</h6>
                    
                    <div class="analysis-item">
                        <h6 class="analysis-label">Primary Scenario</h6>
                        <div class="analysis-value" id="primaryScenario">
                            Bajista hacia Liquidez Inferior. El precio se encuentra en un retroceso después de un movimiento bajista significativo. Se espera que continúe su movimiento bajista hacia la zona de liquidez compradora alrededor de $2400.
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h6 class="analysis-label">Invalidation</h6>
                        <div class="analysis-value" id="invalidation">
                            Cierre de vela de 4H por encima de $2600 invalidaría este escenario.
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h6 class="analysis-label">Associated Setup</h6>
                        <div class="analysis-value" id="associatedSetup">
                            <strong>CORTO</strong>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h6 class="analysis-label">Entry Condition</h6>
                        <div class="analysis-value" id="entryCondition">
                            Entrar en corto en el retest de la zona de resistencia en $2550-$2580 (50% de Fibonacci y 200MA), con confirmación de un ChoCH bajista en 15M.
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h6 class="analysis-label">Ideal Entry Price</h6>
                        <div class="analysis-value bearish" id="entryPrice">
                            $2570.00
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h6 class="analysis-label">Target Zones</h6>
                        <div class="analysis-value" id="targetZones">
                            <div>$2520.00 - $2500.00</div>
                            <div>$2450.00 - $2420.00</div>
                            <div>$2400.00 - $2380.00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script para el gráfico -->
    <script src="{{ url_for('static', path='/js/tradingview-chart.js') }}"></script>
</body>
</html>
